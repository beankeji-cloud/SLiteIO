# =======================================================================
# Copyright 2021 The LiteIO Authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
# =======================================================================
# Modifications by The SLiteIO Authors on 2025:
# - Modification : support lvm thin volume

apiVersion: v1
kind: ConfigMap
metadata:
  name: storage-setting
  namespace: obnvmf
data:
  config.yaml: |
    scheduler:
      maxRemoteVolumeCount: 3
      minLocalStoragePct: 20
      filters:
      - Basic
      - Affinity
      - ObReplica
      - MinLocalStorage
      priorities:
      - LeastResource
      - PositionAdvice
      remoteIgnoreAnnoSelector:
        obnvmf/regard-as-remote: "false"
      lockSchedConfig:
        nodeSelector:
        - key: lite.io/lock-node
          operator: Exists
        nodeTaints:
        - key: lite.io/hardware-broken
          operator: Exists
      #nodeReservations:
      #- id: obnvmf/app-vol
      #  size: 107374182400 # 100Gi
    pluginConfigs:
      defaultLocalSpaceRules:
        - enableDefault: true
          defaultLocalStoragePct: 100
          labelSelector:
            matchLabels:
              lite.io/app-type: db
      autoAdjustLocal:
        enable: true
        maxCountInProcess: 1
        labelSelector:
          matchLabels:
            lite.io/app-type: db
  agent-config.yaml: |
    storage:
      pooling:
        name: liteio-vg
        mode: KernelLVM
      pvs:
      - devicePath: /dev/sdc    
  agent-thin-config.yaml: |
    storage:
      pooling:
        name: liteio-vg
        mode: KernelLVM
        isThin: true
        thinPoolName: liteio-thin-pool
        overprovisionRatio: 2.0
      pvs:
      - devicePath: /dev/sdc